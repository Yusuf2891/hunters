<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HunterVerse Quest Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #0b1220, #050910);
      color: #e6eef6;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: 60px auto;
      padding: 20px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(0,255,255,0.08);
    }
    h1 {
      color: #00ffe0;
      text-shadow: 0 0 10px #00ffe0;
      font-size: 1.6em;
      margin-bottom: 10px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(0,255,255,0.2);
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
      text-align: left;
    }
    .logout {
      background: #00ffe0;
      border: none;
      color: #011a18;
      font-weight: bold;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      margin-top: 20px;
    }
    .logout:hover { background: #00c2ac; transform: scale(1.03); }
  </style>
</head>
<body>
  <div class="container">
    <h1>HUNTERVERSE QUEST DASHBOARD</h1>
    <h3 id="username">Adventurer</h3>
    <p id="levelInfo">Level: 1 | XP: 0 / 100</p>
    <button class="logout" id="logoutBtn">Logout</button>
    <h2 style="margin-top:30px;">Daftar Quest</h2>
    <div id="questContainer"><p>Belum ada quest tersedia.</p></div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // --- Supabase setup ---
    const SUPABASE_URL = "https://xkvqyxkuoodifkqobzym.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrdnF5eGt1b29kaWZrcW9ienltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4OTIzMzYsImV4cCI6MjA3NjQ2ODMzNn0.jBhV6-HF7VyUWkUiYwTXDxp6UmLXOTqn9KC9fdMWAXI";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- Cek sesi login ---
    async function checkSession() {
      const { data, error } = await supabase.auth.getSession();
      if (!data.session) {
        window.location.href = "login.html";
        return;
      }
      const user = data.session.user;
      document.getElementById("username").textContent = user.email.split("@")[0];
      loadProfile(user.id);
      loadQuests();
    }

    // --- Ambil profil dari tabel profiles ---
    async function loadProfile(userId) {
      const { data, error } = await supabase
        .from("profiles")
        .select("level, xp, next_level_xp")
        .eq("id", userId)
        .single();

      if (error) {
        console.warn("Gagal memuat profil:", error.message);
        return;
      }

      document.getElementById("levelInfo").textContent =
        `Level: ${data.level} | XP: ${data.xp} / ${data.next_level_xp}`;
    }

    // --- Ambil semua quest ---
    async function loadQuests() {
      const questContainer = document.getElementById("questContainer");
      questContainer.innerHTML = "<p>Memuat quest...</p>";

      const { data, error } = await supabase
        .from("quests")
        .select("*")
        .order("created_at", { ascending: true });

      if (error) {
        console.error("Error ambil quest:", error);
        questContainer.innerHTML = "<p style='color:red;'>Gagal memuat quest.</p>";
        return;
      }

      if (!data || data.length === 0) {
        questContainer.innerHTML = "<p>Belum ada quest tersedia.</p>";
        return;
      }

      questContainer.innerHTML = data.map(q => `
        <div class="card">
          <h3 style="color:#00ffe0;">${q.title}</h3>
          <p>${q.description}</p>
          <p>ðŸŽ¯ Kesulitan: ${q.difficulty}</p>
          <p>ðŸ’Ž Hadiah: ${q.reward} XP</p>
        </div>
      `).join('');
    }

    // --- Tombol logout ---
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    // --- Jalankan ---
    checkSession();
  </script>
</body>
</html>
